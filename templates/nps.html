<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSAT and NPS Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
          body {
            /* background-color: #eef1ef; */
            color: #222222;
            font-family: "Poppins", sans-serif;
            background-image: url('https://www.auxilo.com/assets/images/home/banner-bg.jpg');
            background-size: cover;
            background-repeat: no-repeat;
        }
        .container {
            padding: 0 15px;
        }
        .card {
            margin: 15px 0;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: scale(1.02);
        }
        /* Navbar styles */
        /* Navbar styles */
        .navbar {
            /* background-color: #eef1ef; */
            color: #000000;
            display: flex;
            align-items: center;
            padding: 10px 15px;
        }

        /* Brand link styles */
        .navbar-brand {
            color: #000000;
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        /* Logo styling */
        .navbar-brand img {
            height: 60px;
            /* Adjust height as needed */
            width: auto;
            /* Maintain aspect ratio */
        }

        .nav-link.dropdown-toggle {
            color: #000000 !important;
            /* Ensure the username appears in black */
        }

        .navbar-dark .navbar-nav .show>.nav-link {
            color: #000000;
        }

        /* Profile dropdown styling */
        .profile-dropdown {
            cursor: pointer;
        }

        h1 {
            font-weight: 600;
            font-size: 32px;
        }

        .card-body {
            position: relative;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .card-title {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        .chart-container {
            height: 464px;
        }
        .zc-ref {
            display: none;
        }
        .loading {
            text-align: center;
            color: #999;
            font-size: 1.2rem;
        }
        .progress-bar {
            height: 5px;
            background-color: #007bff;
            transition: width 1s ease-in-out;
        }
        .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        .list-group-item:nth-child(even) {
            background-color: #f9f9f9;
        }
        .list-group-item:nth-child(odd) {
            background-color: #fff;
        }
        .card.csat-card {
            background-color: #e3f2fd; /* Light blue */
            color: #333;
        }
        .card.nps-card {
            background-color: #ffe0b2; /* Light orange */
            color: #333;
        }
        .card.detractor-details-card {
            background-color: #ffcccb; /* Light red */
            color: #333;
        }
        .card.passive-details-card {
            background-color: #fff9c4; /* Light yellow */
            color: #333;
        }
        .card.promoter-details-card {
            background-color: #c8e6c9; /* Light green */
            color: #333;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
            }
            .list-group-item {
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 0.25rem;
    margin-bottom: -1px; /* Remove bottom margin for the last item */
}

/* Style for the accordion container */
.accordion {
    margin: 20px 0;
}

/* Style for the accordion headers */
.accordion-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #ddd;
}

/* Style for the accordion buttons */
.accordion-button {
    color: #333;
    background-color: #f8f9fa;
    border: none;
    border-radius: 0.25rem;
    font-weight: bold;
    padding: 15px;
    text-align: left;
    cursor: pointer;
}

/* Style for the accordion buttons on hover */
.accordion-button:hover {
    background-color: #e9ecef;
}

/* Style for the accordion body */
.accordion-body {
    padding: 15px;
    background-color: #ffffff;
    border: 1px solid #ddd;
    border-top: none; /* Remove top border */
}

/* Active accordion button */
.accordion-button:not(.collapsed) {
    color: #495057;
    background-color: #e9ecef;
}
/* Accordion item color styles */
.accordion-item.positive-comments {
    border-left: 5px solid green;
}

.accordion-item.positive-comments .accordion-button {
    background-color: #e0f7e0; /* Light green background for positive comments */
    color: green; /* Green text for positive comments */
}

.accordion-item.negative-comments {
    border-left: 5px solid red;
}

.accordion-item.negative-comments .accordion-button {
    background-color: #f8d7da; /* Light red background for negative comments */
    color: red; /* Red text for negative comments */
}

.accordion-item.suggestions-comments {
    border-left: 5px solid rgb(81, 66, 216);
}

.accordion-item.suggestions-comments .accordion-button {
    background-color: #fff3cd; /* Light yellow background for suggestions */
    color: #4252df; /* Yellow text for suggestions */
}

        #myDonutChart {
            width: 80%;
            height: 500px;
            margin: 0 auto;
            }
            .accordion {
    margin: 20px 0;
}

/* Style for the accordion headers */
.accordion-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #ddd;
}

/* Style for the accordion buttons */
.accordion-button {
    color: #333;
    background-color: #f8f9fa;
    border: none;
    border-radius: 0.25rem;
    font-weight: bold;
    padding: 15px;
    text-align: left;
    cursor: pointer;
}

/* Style for the accordion buttons on hover */
.accordion-button:hover {
    background-color: #e9ecef;
}

/* Style for the accordion body */
.accordion-body {
    padding: 15px;
    background-color: #ffffff;
    border: 1px solid #ddd;
    border-top: none; /* Remove top border */
}

/* Active accordion button */
.accordion-button:not(.collapsed) {
    color: #495057;
    background-color: #e9ecef;
}
.dashboard-header {
    display: flex;
    flex-direction: column;
    align-items: center; /* Center-align the heading and date */
        }
.dashboard-header h1 {
    margin: 0; /* Remove default margin */
    font-size: 2rem; /* Adjust size as needed */
        }
.dashboard-header p {
    margin: 0; /* Remove default margin */
    font-size: 1.5rem; /* Slightly smaller size than the heading */
    color: #555; /* Optional: Add color for distinction */
        }
        .nps-card {
  position: relative;
  padding: 15px;
  background-color: #fff;
  border-radius: 6px;
}

.nps-hint {
  height: 30px;
  width: 30px;
  color: white;
  background-color: rgba(0,0,0,0.85);
  border-radius: 15px;
  position: absolute;
  right: -15px;
  top: -15px;
  transition: .2s ease;
  display: flex;
  justify-content: center;
  align-items: center;
}

.nps-hint > span {
  position: absolute;
  top: 7px;
  right: 12px;
}

.nps-hint > p {
  overflow: hidden;
  max-height: 0px;
  transition-delay: 0.2s;
  color: #fff;
  padding: 10px;
}

#nps-hint-click:checked + .nps-hint {
  height: calc(100% + 30px);
  width: calc(100% + 30px);
}

#nps-hint-click:checked + .nps-hint > p {
  max-height: 999px;
}
/* Ensure the accordion looks good on smaller screens */
@media (max-width: 768px) {
    .accordion-button {
        font-size: 14px;
        padding: 10px;
    }
}

        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
        @media(max-width:576px) {
            .navbar-brand img {
                height: 50px;
                width: auto;
            }

            .profile-dropdown img {
                width: 32px;
                height: 32px;
            }

            h1 {
                font-weight: 600;
                font-size: 24px;
            }

            .card-img-top {
                height: 190px;
            }
            .card-title {
                font-size: 1.3rem;
            }
            #user_name{
                font-size: 14px;
            }
        }
        .custom-back-button {
        background-color: #6c757d; /* Bootstrap's secondary color */
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        transition: background-color 0.3s ease, transform 0.3s ease;
    }

    .custom-back-button:hover {
        background-color: #5a6268; /* Darker shade on hover */
        transform: translateY(-2px); /* Slight lift on hover */
    }

    .custom-back-button:active {
        background-color: #545b62; /* Even darker shade on click */
        transform: translateY(0); /* Reset lift on click */
    }

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container d-flex ">
            <div class="text-left">
                <button id="backButton" class="btn btn-secondary custom-back-button" onclick="history.back()">Back</button>
            </div>
            <div><a class="navbar-brand" href="#">
                <img src="https://www.auxilo.com/assets/images/Auxilo-logo-horizontal.svg" alt="Auxilo Logo">
                <!-- <img src="{{ url_for('static', filename='images/Auxilo-logo.svg') }}" alt="Auxilo Logo"> -->
                </a>
            </div>
            <div class="">
                <ul class="navbar-nav">
                    <!-- Profile dropdown -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle profile-dropdown" href="#" id="navbarDropdown" role="button"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <!-- <img src="{{ url_for('static', filename='images/profile.png') }}" alt="Profile" class="rounded-circle" width="60" height="60"> -->
                            <img src="https://cdn-icons-png.flaticon.com/128/4140/4140047.png" alt="Profile"
                                class="rounded-circle mr-2" width="40" height="40">
                            <span id="user_name">{{ user_name }}</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <span class="dropdown-item-text"><span id="user_name_display">{{ user_name }}</span></span>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="/cxm/logout">Logout</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="dashboard-header mb-4 text-center">
            <h1>NPS Dashboard</h1>
            <p id="datetime"></p>
        </div>
        <div class="mb-4">
            <div class="form-row">
                <div class="col-md-4 mb-2">
                    <label for="startDate">Start Date:</label>
                    <input type="date" id="startDate" class="form-control">
                </div>
                <div class="col-md-4 mb-2">
                    <label for="endDate">End Date:</label>
                    <input type="date" id="endDate" class="form-control">
                </div>
                <div class="col-md-3 mb-2">
                    <label for="location-select">Select Location:</label>
                    <select id="location-select" class="form-control">
                        <option value="all">All Locations</option>
                        <!-- Options will be dynamically populated here -->
                    </select>
                </div>
                <div class="col-md-3 mb-2 d-flex align-items-end">
                    <button id="applyFilter" class="btn btn-primary">Apply Filter</button>
                </div>
            </div>
        </div>
        <div class="row">
            <!-- Gauge Chart -->
            <div class="col-12">
                <div class="card nps-card">
                    <div class="card-body">
                        <h5 class="card-title">NPS Percentage</h5>
                        <div id="npsChart" class="chart-container"></div>
                        <label for="nps-hint-click">
                            <input type="checkbox" id="nps-hint-click" style="display: none;">
                            <div class="nps-hint">
                                <span class="fa fa-info"></span>
                                <p>Net Promoter Score = % Promoters - % Detractors.</p>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
                <div class="card nps-card">
                    <div class="card-body">
                        <h5 class="card-title text-center">NPS Details</h5>
                        <p class="text-center">Total Responses: <span id="totalNps">Loading...</span></p>
                        <div id="myDonutChart"></div>
                    </div>
                </div>
                <!-- Map for Branches -->
                <div class="col-12">
                    <div class="card nps-card">
                        <div class="card-body">
                            <h5 class="card-title text-center">BranchWise Details</h5>
                            
                            <!-- Location Dropdown -->
                            <div class="form-group">
                                <label for="location-select">Select Location:</label>
                                <select class="form-control" id="location-select" onchange="updateMap()">
                                    <option value="all">All Locations</option>
                                </select>
                            </div>
                            
                            <div id="mapChart" class="chart-container"></div>
                        </div>
                    </div>
                </div>

                <div class="accordion" id="accordionExample">
                    <div class="accordion-item positive-comments">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                Positive Comments (<span id="positiveCount">0</span>)
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                            <div id="positiveCommentsList" class="accordion-body">
                                <!-- Positive comments will be dynamically inserted here -->
                            </div>
                        </div>
                    </div>
                
                    <div id="negativeAccordion" class="accordion-item negative-comments">
                        <h2 class="accordion-header" id="headingNegative">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNegative" aria-expanded="false" aria-controls="collapseNegative">
                                Negative Comments (<span id="negativeCount">0</span>)
                            </button>
                        </h2>
                        <div id="collapseNegative" class="accordion-collapse collapse" aria-labelledby="headingNegative" data-bs-parent="#accordionExample">
                            <ul id="negativeCommentsList" class="list-group">
                                <!-- Negative comments will be dynamically inserted here -->
                            </ul>
                        </div>
                    </div>
                
                    <div id="suggestionsAccordion" class="accordion-item suggestions-comments">
                        <h2 class="accordion-header" id="headingSuggestions">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSuggestions" aria-expanded="false" aria-controls="collapseSuggestions">
                                Suggestions (<span id="suggestionsCount">0</span>)
                            </button>
                        </h2>
                        <div id="collapseSuggestions" class="accordion-collapse collapse" aria-labelledby="headingSuggestions" data-bs-parent="#accordionExample">
                            <ul id="suggestionsList" class="list-group">
                                <!-- Suggestions will be dynamically inserted here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const branchMap = {
            'HYDERABAD': 'TL',
            'CHENNAI': 'TN',
            'BENGALURU': 'KA',
            'PUNE': 'MH',
            'CC AHMEDABAD': 'GJ',
            'DELHI': 'DL',
            'AHMEDABAD': 'GJ',
            'MUMBAI': 'MH',
            'CC MUMBAI': 'MH',
            'CC HYDERABAD': 'TL'
        };
    
        const colors = {
            'HYDERABAD': '#FF5733',
            'CHENNAI': '#33FF57',
            'BENGALURU': '#3357FF',
            'PUNE': '#FF33A6',
            'CC AHMEDABAD': '#33FFF6',
            'DELHI': '#A633FF',
            'AHMEDABAD': '#FF33C1',
            'MUMBAI': '#C1FF33',
            'CC MUMBAI': '#FFAF33',
            'CC HYDERABAD': '#AF33FF'
        };
    
        async function fetchDataAndRenderChart() {
            const response = await fetch(`/api/survey/npsbranch`);
            const data = await response.json();
    
            // Populate dropdown with unique branches
            const locationSelect = document.getElementById("location-select");
            const uniqueBranches = [...new Set(data.map(branch => branch.branch))];
            uniqueBranches.forEach(branch => {
                const option = document.createElement("option");
                option.value = branch;
                option.textContent = branch;
                locationSelect.appendChild(option);
            });
    
            // Store the data globally to make it accessible in the updateMap function
            window.branchData = data;
    
            // Initially render the map with all branches
            updateMap();
        }
    
        function updateMap() {
            const selectedLocation = document.getElementById("location-select").value;
            const data = window.branchData;
    
            const filteredData = selectedLocation === "all" 
                ? data 
                : data.filter(branch => branch.branch === selectedLocation);
    
            const items = {};
            filteredData.forEach(branch => {
                const stateCode = branchMap[branch.branch];
                if (stateCode) {
                    const color = colors[branch.branch] || '#00bcd4';
                    items[stateCode] = {
                        tooltip: {
                            text: `${branch.branch} has ${branch.comments_count} comments`,
                            backgroundColor: color
                        },
                        backgroundColor: color,
                        label: {
                            visible: true
                        }
                    };
                }
            });
    
            const mapChartConfig = {
                shapes: [
                    {
                        type: 'zingchart.maps',
                        options: {
                            name: 'ind',
                            panning: false,
                            zooming: false,
                            scrolling: false,
                            style: {
                                tooltip: {
                                    borderColor: '#000',
                                    borderWidth: '2px',
                                    fontSize: '18px'
                                },
                                borderColor: '#000',
                                borderWidth: '2px',
                                controls: {
                                    visible: false
                                },
                                hoverState: {
                                    alpha: .28
                                },
                                items: items,
                                label: {
                                    fontSize: '15px',
                                    visible: false
                                }
                            }
                        }
                    }
                ]
            };
    
            zingchart.loadModules('maps,maps-ind');
            zingchart.render({
                id: 'mapChart',
                data: mapChartConfig
            });
        }
        async function fetchNPSData(startDate, endDate, location) {
            try {
                const url = startDate && endDate && location !== "all"
                    ? `/api/survey/nps?question_id=4&start_date=${startDate}&end_date=${endDate}&location=${location}`
                    : startDate && endDate
                    ? `/api/survey/nps?question_id=4&start_date=${startDate}&end_date=${endDate}`
                    : `/api/survey/overall_nps?question_id=4`;
    
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                console.log('Fetched Data:', data); // Debugging: log the data
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
                return null; // Return null in case of error
            }
        }
    
        function updateChart(data) {
            if (!data) {
                console.error('No data to update chart');
                return;
            }
    
            const detractors = data.detractors || 0;
            const passives = data.passive || 0;
            const promoters = data.promoters || 0;
    
            const chartData = [{
                values: [detractors, passives, promoters],
                labels: ['Detractors', 'Passives', 'Promoters'],
                type: 'pie',
                hole: 0.4,
                textinfo: 'label+percent',
                textposition: 'inside',
                marker: {
                    colors: ['#ff4d4d', '#4d79ff', '#2e8b57']
                },
                showlegend: true,
                rotation: 90,
                sort: false
            }];
    
            const layout = {
                title: {
                    text: 'NPS Survey Results',
                    font: {
                        size: 24
                    },
                    x: 0.5
                },
                annotations: [
                    {
                        text: 'NPS',
                        x: 0.5,
                        y: 0.5,
                        font: {
                            size: 28,
                            color: '#000'
                        },
                        showarrow: false
                    }
                ],
                margin: {
                    t: 50,
                    b: 40,
                    l: 40,
                    r: 40
                },
                transition: {
                    duration: 500,
                    easing: 'cubic-in-out'
                }
            };
    
            Plotly.react('myDonutChart', chartData, layout);
        }
    
        document.addEventListener('DOMContentLoaded', function () {
            var today = new Date();
            var options = { year: 'numeric', month: 'long', day: 'numeric' };
            var formattedDate = today.toLocaleDateString(undefined, options);
            document.getElementById('datetime').textContent = formattedDate;
    
            // Function to fetch NPS data
            async function fetchNpsData(startDate, endDate, branch) {
    const url = branch && branch !== "all" && startDate && endDate
        ? `/api/survey/nps/location?question_id=4&branch=${branch}&start_date=${startDate}&end_date=${endDate}`
        : branch && branch !== "all"
            ? `/api/survey/nps/location?question_id=4&branch=${branch}`
            : startDate && endDate
                ? `/api/survey/nps?question_id=4&start_date=${startDate}&end_date=${endDate}`
                : `/api/survey/overall_nps?question_id=4`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        const npsPercentage = data.nps_percentage.toFixed(2);
        const totalNps = data.total_nps;

        // Update NPS details
        document.getElementById('totalNps').innerText = totalNps;
    
                    // Create the ZingChart gauge for NPS
                    var myConfig = {
                        type: "gauge",
                        globals: {
                            fontSize: 25
                        },
                        plotarea: {
                            marginTop: 60
                        },
                        plot: {
                            size: '100%',
                            valueBox: {
                                placement: 'center',
                                text: '%v%',
                                fontSize: 35,
                                rules: [{
                                    rule: '%v >= 50',
                                    text: '%v%<br>EXCELLENT'
                                },
                                {
                                    rule: '%v < 50 && %v >= 0',
                                    text: '%v%<br>GOOD'
                                },
                                {
                                    rule: '%v < 0',
                                    text: '%v%<br>DETRACTORS'
                                }]
                            }
                        },
                        scaleR: {
                            aperture: 180,
                            minValue: -100,
                            maxValue: 100,
                            step: 20,
                            center: {
                                visible: false
                            },
                            tick: {
                                visible: false
                            },
                            item: {
                                offsetR: 0
                            },
                            labels: ['-100', '-80', '-60', '-40', '-20', '0', '20', '40', '60', '80', '100'],
                            ring: {
                                size: 50,
                                rules: [{
                                    rule: '%v < -50',
                                    backgroundColor: '#E53935'
                                },
                                {
                                    rule: '%v >= -50 && %v < 0',
                                    backgroundColor: '#FFA726'
                                },
                                {
                                    rule: '%v >= 0 && %v < 50',
                                    backgroundColor: '#FFD700'
                                },
                                {
                                    rule: '%v >= 50',
                                    backgroundColor: '#66BB6A'
                                }]
                            }
                        },
                        series: [{
                            values: [parseFloat(npsPercentage)], // Use formatted percentage
                            backgroundColor: 'black',
                            indicator: [10, 10, 10, 10, 0.75],
                            animation: {
                                effect: 2,
                                method: 1,
                                sequence: 4,
                                speed: 900
                            }
                        }]
                    };
    
                    zingchart.render({
                        id: 'npsChart',
                        data: myConfig,
                        height: '100%',
                        width: '100%'
                    });
    
                    updateChart(data); // Update the donut chart with new data
                    updateMap(); // Update the map with new data
                } catch (error) {
                    console.error("Error fetching NPS data:", error);
                }
            }
    
            document.getElementById("applyFilter").addEventListener("click", function () {
                const startDate = document.getElementById("startDate").value;
                const endDate = document.getElementById("endDate").value;
                const branch = document.getElementById("location-select").value;
    
                fetchNpsData(startDate, endDate, branch);
            });
    
            // Update the map when the branch dropdown changes
            document.getElementById("location-select").addEventListener("change", function () {
                const selectedBranch = this.value;
                const startDate = document.getElementById("startDate").value;
                const endDate = document.getElementById("endDate").value;
    
                fetchNpsData(startDate, endDate, selectedBranch);
            });
            async function displayComments() {
    try {
        const response = await fetch(`/api/survey/nps/classifications`);
        const data = await response.json();

        // Log the data to inspect its structure
        console.log('Fetched Data:', data);

        const positiveCommentsList = document.getElementById('positiveCommentsList');
        const negativeCommentsList = document.getElementById('negativeCommentsList');
        const suggestionsList = document.getElementById('suggestionsList');

        // Safely check for counts and use fallback values if undefined
        const counts = data.counts || { positive: 0, negative: 0, suggestions: 0 };
        document.getElementById('positiveCount').textContent = counts.positive || 0;
        document.getElementById('negativeCount').textContent = counts.negative || 0;
        document.getElementById('suggestionsCount').textContent = counts.suggestions || 0;

        // Clear existing comments
        positiveCommentsList.innerHTML = '';
        negativeCommentsList.innerHTML = '';
        suggestionsList.innerHTML = '';

        // Safely check for comment arrays and use empty arrays if undefined
        const positiveComments = data.positive_comments || [];
        const negativeComments = data.negative_comments || [];
        const suggestions = data.suggestions || [];

        // Populate Positive Comments
        positiveComments.forEach(comment => {
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.innerHTML = `<strong>Comment:</strong> ${comment.text_response}<br>
                            <strong>Lead ID:</strong> ${comment.lead_id}<br>
                            <strong>Name:</strong> ${comment.name}<br>
                            <strong>Email:</strong> ${comment.email}<br>
                            <strong>Mobile:</strong> ${comment.mobile}<br>
                            <strong>Branch:</strong> ${comment.branch}<br>
                            <strong>Date:</strong> ${comment.date}<br>`;
            positiveCommentsList.appendChild(li);
        });

        // Populate Negative Comments
        negativeComments.forEach(comment => {
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.innerHTML = `<strong>Comment:</strong> ${comment.text_response}<br>
                            <strong>Lead ID:</strong> ${comment.lead_id}<br>
                            <strong>Name:</strong> ${comment.name}<br>
                            <strong>Email:</strong> ${comment.email}<br>
                            <strong>Mobile:</strong> ${comment.mobile}<br>
                            <strong>Branch:</strong> ${comment.branch}<br>
                            <strong>Date:</strong> ${comment.date}<br>`;
            negativeCommentsList.appendChild(li);
        });

        // Populate Suggestions
        suggestions.forEach(suggestion => {
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.innerHTML = `<strong>Suggestion:</strong> ${suggestion.text_response}<br>
                            <strong>Lead ID:</strong> ${suggestion.lead_id}<br>
                            <strong>Name:</strong> ${suggestion.name}<br>
                            <strong>Email:</strong> ${suggestion.email}<br>
                            <strong>Mobile:</strong> ${suggestion.mobile}<br>
                            <strong>Branch:</strong> ${suggestion.branch}<br>
                            <strong>Date:</strong> ${suggestion.date}<br>`;
            suggestionsList.appendChild(li);
        });

            } catch (error) {
                console.error('Error fetching comments:', error);
            }
        }

            fetchNpsData(); // Initial data fetch and render
            fetchDataAndRenderChart();
            displayComments('nps');
        });
        
    </script>
    
      
</body>
</html>
